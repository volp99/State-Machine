Replacing Enumerated States with a State Machine
